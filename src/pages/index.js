import Head from 'next/head';
import { Container, Typography } from '@mui/material';
import Accordion from '@mui/material/Accordion';
import AccordionSummary from '@mui/material/AccordionSummary';
import AccordionDetails from '@mui/material/AccordionDetails';
import ExpandMoreIcon from '@mui/icons-material/ExpandMore';
import Grid from '@mui/material/Unstable_Grid2';
import Box from '@mui/material/Box';
import Card from '@mui/material/Card';
import CardContent from '@mui/material/CardContent';
import CardMedia from '@mui/material/CardMedia';

/*  Todo:
    Create a page where a list of different Anime is shown using cards
    Each card represents an anime and should have an image on the left, title on the right, and a link to the latest episode of that anime underneath the title
    The list of anime should be fetched from the Jikan API

    The page should be responsive and should look good on mobile devices
    The page should be styled using Material UI
*/

const jikanBaseUrl = 'https://api.jikan.moe/';
const version = 'v4';
const API = `${jikanBaseUrl}${version}`;

const endpoints = {
    top: '/top/anime',
    search: '/anime',
};

export async function getStaticProps() {
    const res = await fetch(`${API}${endpoints.top}`);
    const top = await res.json();

    return {
        props: {
            top,
        },
    };
}

export default function Home({ top }) {
    const animeList = top.data.map(({ mal_id, title, title_japanese, images, episodes }) => ({
        id: mal_id,
        title,
        title_japanese,
        image: images.webp.image_url,
        nrOfEpisodes: episodes,
    })) || [];

    return (
        <>
            <Head>
                <title>Create Next App</title>
                <meta name="description" content="Generated by create next app" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
                <link rel="icon" href="/favicon.ico" />
            </Head>
            <main>
                <Container maxWidth="md">
                    <Typography variant="h1" component="h1" gutterBottom>
                        My Anime
                    </Typography>

                    <Accordion>
                        <AccordionSummary
                            expandIcon={<ExpandMoreIcon />}
                            aria-controls="panel1a-content"
                            id="panel1a-header"
                        >
                            <Typography variant="h2" component="h2" gutterBottom>
                                Top Anime
                            </Typography>
                        </AccordionSummary>
                        <AccordionDetails>
                            <Grid container spacing={2}>
                                {animeList.map(({ title, image, nrOfEpisodes }, index) => (
                                    <Grid key={index} xs={6}>
                                        <Card sx={{ display: 'flex' }}>
                                            <CardMedia
                                                component="img"
                                                sx={{ width: 150 }}
                                                image={ image }
                                                alt={ title }
                                            />
                                            <Box sx={{ display: 'flex', flexDirection: 'column' }}>
                                                <CardContent>
                                                    <Typography component="div" gutterBottom>
                                                        { title }
                                                    </Typography>
                                                    <Typography component="p" gutterBottom>
                                                        { nrOfEpisodes } episodes
                                                    </Typography>
                                                </CardContent>
                                            </Box>
                                        </Card>
                                    </Grid>
                                ))}
                            </Grid>
                        </AccordionDetails>
                    </Accordion>
                </Container>
            </main>
        </>
    );
}
